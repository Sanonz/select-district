/**
 * Date:2014-05-28
 * Author:Sanonz <sanonz@126.com>
 */


var sdSelfData=[];
(function(d){d.fn.selectDistrict=function(b){function e(b){if(!1===b)return d('.sd-select-box[mark!="'+a.mark+'"]');if(sdSelfData[a.mark])return b?sdSelfData[a.mark].find(b):sdSelfData[a.mark];sdSelfData[a.mark]=d('.sd-select-box[mark="'+a.mark+'"]');return b?sdSelfData[a.mark].find(b):sdSelfData[a.mark]}function p(a){var b=0,d;for(d in a)"function"!=typeof a[d]&&++b;return b}function q(a,b,s,g){var c;g?c=d(g).attr("data-value"):(c=d(a).attr("data-area"),g=h.find('.sd-selection-area span[data-value="'+c+
'"]'));if(0<g.length){if(3==s)return a=e('.sd-select-content > table[data-value="'+c+'"]'),a.find('input[type="checkbox"]').each(function(){d(this).prop("checked",!1);m(null,d(this),0)}),a.find(".sd-select-district a").each(function(){l(this,2);d(this).removeClass("cur")}),g.remove(),n(),!0;c=m(null,b,3);var f=d(a).parent(".sd-select-district").children("a.cur").length;if(2==s)return d(a).removeClass("cur"),l(a,2),--f,0==m(g,b,2)&&(g.remove(),n()),c>f&&b.prop("checked",!1),!0;d(a).addClass("cur");
l(a);++f;m(g,b,1);c==f&&b.prop("checked",!0);return!0}g=d(a).parents(".sd-select-box").find('.sd-select-area a[data-value="'+c+'"]');if(0>=g.length)return!1;d(a).addClass("cur");l(a);m(null,b,1);h.find(".sd-selection-area").append('<span data-value="'+c+'">'+g.attr("data-name")+'<b class="already" data-total="1">(1)</b><i title="\u79fb\u9664"></i></span>');n();return!0}function l(a,b){if(a)var c=d(a).attr("data-value");var g=h.find(".sd-selection-value"),e=g.val();4!=b&&d(a).parents(".sd-select-district").siblings('input[type="checkbox"]');
""!=e&&(/^\|/.test(e)||(e="|"+e),/\|$/.test(e)||(e+="|"));if(2==b)return-1<e.indexOf("|"+c+"|")?(e=e.replace(new RegExp("\\|"+c+"\\|"),"|"),g.val(e),2):-2;if(3==b)return e;g.val(4==b?c:5==b?"":""==e?"|"+c+"|":e+(c+"|"));return 1}function m(a,b,d){var c;if(b){c=b.siblings(".sd-select-statistics");if(3==d)return parseInt(c.children(".total").text());b=c.children(".already");c=parseInt(b.text());0==d?c=0:1==d?++c:2==d?--c:c=parseInt(d);b.text(c)}a&&(a=a.children(".already"),c=parseInt(a.attr("data-total")),
0==d?c=0:1==d?++c:2==d?--c:c=parseInt(d),a.text("("+c+")").attr("data-total",c));return c}function n(){e().animate({top:h.offset().top+a.offsetTop+h.outerHeight()})}var a={offsetTop:10,offsetLeft:0,maxNumber:0,areas:{},provinces:{},citys:{},districts:{},mark:d(this).attr("id")},h=d(this),t=d(this).offset(),a=d.extend(a,b);b=""+('<div class="sd-select-box" mark="'+a.mark+'" style="display:none;top:'+(t.top+h.outerHeight()+a.offsetTop)+"px;left:"+(t.left+a.offsetLeft)+'px;">');b+='<div class="sd-select-title clearFix"><span class="fl">\u670d\u52a1\u5730\u533a\u9009\u62e9 <a href="javascript:void(0);" class="sd-select-all" data-value="all">\u5168\u56fd</a></span> <span class="fr"><a href="javascript:void(0);" class="close">X</a></span></div><div class="sd-select-area">';
for(var c in a.areas)b+='<a href="javascript:void(0);" data-value="'+a.areas[c].id+'" data-name="'+a.areas[c].name+'" '+(0==c?'class="cur"':"")+">"+a.areas[c].name+'<b class="sd-select-statistics" data-total="'+p(a.provinces[a.areas[c].id])+'">('+p(a.provinces[a.areas[c].id])+")</b><i></i></a>";b+="</div>";b+='<div class="sd-select-content">';for(c in a.areas){b+='<table cellspacing="0" cellpadding="0" class="sd-select-show" data-value="'+a.areas[c].id+'" style="display:'+(0==c?"table":"none")+
';">';for(var f in a.provinces[a.areas[c].id]){b+="<tr>";b+='<td class="sd-select-province"><input type="checkbox" name="'+a.provinces[a.areas[c].id][f].name+'" id="'+a.mark+"_province-"+a.provinces[a.areas[c].id][f].id+'" data-value="1" data-area="'+a.areas[c].id+'" /> <label for="'+a.mark+"_province-"+a.provinces[a.areas[c].id][f].id+'">'+a.provinces[a.areas[c].id][f].name+'</label> <b class="sd-select-statistics" data-total="'+p(a.citys[a.provinces[a.areas[c].id][f].id])+'">('+p(a.citys[a.provinces[a.areas[c].id][f].id])+
")</b></td>";b+='<td class="sd-select-city">';b+='<ul class="sd-select-city-list clearFix">';for(var k in a.citys[a.provinces[a.areas[c].id][f].id]){b+="<li>";b+='<input type="checkbox" name="'+a.citys[a.provinces[a.areas[c].id][f].id][k].name+'" id="'+a.mark+"_city-"+a.citys[a.provinces[a.areas[c].id][f].id][k].id+'" data-value="'+a.citys[a.provinces[a.areas[c].id][f].id][k].id+'" data-area="'+a.areas[c].id+'" /> <label for="'+a.mark+"_city-"+a.citys[a.provinces[a.areas[c].id][f].id][k].id+
'">'+a.citys[a.provinces[a.areas[c].id][f].id][k].name+'</label> <b class="sd-select-statistics">(<u class="total">'+p(a.districts[a.citys[a.provinces[a.areas[c].id][f].id][k].id])+'</u>/<u class="already">0</u>)</b> <i></i>';b+='<div class="line-separate"></div>';b+='<div class="sd-select-district">';for(var u in a.districts[a.citys[a.provinces[a.areas[c].id][f].id][k].id])b+='<a href="javascript:void(0);" data-value="'+a.districts[a.citys[a.provinces[a.areas[c].id][f].id][k].id][u].id+
'" data-area="'+a.areas[c].id+'">'+a.districts[a.citys[a.provinces[a.areas[c].id][f].id][k].id][u].name+"</a>";b+="</div>";b+="</li>"}b+="</ul>";b+="</td>";b+="</tr>"}b+="<tr>";b+='<td class="sd-select-province-all"><input type="checkbox" name="\u5168\u9009" id="'+a.mark+"_province-all-"+a.areas[c].id+'" data-value="1" /> <label for="'+a.mark+"_province-all-"+a.areas[c].id+'" class="sd-select-color-tip">\u5168\u9009</label></td>';b+=
"<td>&nbsp;</td>";b+="</tr>";b+="</table>"}b+="</div>";b+='<div class="sd-select-tip sd-select-color-tip">\u63d0\u793a\uff1a\u5730\u533a\u3001\u7701\u4efd\u3001\u57ce\u5e02\u5747\u53ef\u591a\u9879\u53ef\u9009\uff0c\u590d\u9009\u53d6\u6d88\uff01</div>';b+='<div class="arrow"></div>';b+='<div class="arrow-outer"></div>';b+="</div>";d("body").append(b);var r=l(null,3);"|all|"==r?(e(".sd-select-all").addClass("cur"),e(".sd-select-area, .sd-select-content").append('<div class="sd-select-cover"></div>')):
""!=r&&d(this).find(".sd-selection-area span").each(function(){e('.sd-select-show[data-value="'+d(this).attr("data-value")+'"]').find('.sd-select-province input[type="checkbox"]').each(function(){var a=!0;d(this).parent(".sd-select-province").siblings(".sd-select-city").find('ul li > input[type="checkbox"]').each(function(){var b=d(this),c=!0;d(this).siblings(".sd-select-district").children("a").each(function(){-1<r.indexOf("|"+d(this).attr("data-value")+"|")?(d(this).addClass("cur"),m(null,b,1)):
c=!1});d(this).prop("checked",c);c||(a=!1)});d(this).prop("checked",a)})});d(this).find(".sd-selection-click").click(function(){e(!1).hide();e().slideToggle()});e(".sd-select-title a.close").click(function(){d(this).parents(".sd-select-box").slideUp()});e().on("mouseenter",".sd-select-area a",function(){var a=e('.sd-select-content .sd-select-show[data-value="'+d(this).attr("data-value")+'"]');a.show().siblings().hide();0<a.length&&d(this).addClass("cur").siblings().removeClass("cur")});e(".sd-select-district a").click(function(){var a=
d(this).parents("li").children('input[type="checkbox"]'),b=d(this).hasClass("cur")?2:1;q(this,a,b)});e('.sd-select-city-list li > input[type="checkbox"]').click(function(){var a=d(this),b=d(this).prop("checked"),c=d(this).siblings(".sd-select-district"),e=b?1:2,f=d(this).parents("tr").find('.sd-select-province input[type="checkbox"]'),h=parseInt(f.siblings(".sd-select-statistics").attr("data-total")),k=d(this).parents(".sd-select-city-list").find("li > input:checked"),c=b?c.children('a[class!="cur"]'):
c.children("a.cur");c.each(function(){q(this,a,e)});h==k.length?f.prop("checked",!0):f.prop("checked",!1)});e('.sd-select-province > input[type="checkbox"]').click(function(){var a=d(this).prop("checked"),b=a?1:2;d(this).parents("tr").find(".sd-select-city").find('ul li > input[type="checkbox"]').each(function(){d(this).prop("checked",a);var c=d(this),e=a?'a[class!="cur"]':"a.cur";d(this).siblings(".sd-select-district").children(e).each(function(){q(this,c,b)})})});d(this).on("click",".sd-selection-area span i",
function(){var a=d(this).parent("span");q(null,null,3,a)});e('.sd-select-province-all input[type="checkbox"]').click(function(){var a=d(this).prop("checked"),b=d(this).parents(".sd-select-show"),c=a?1:2;b.find('.sd-select-province input[type="checkbox"]').prop("checked",a);b.find('.sd-select-city ul li > input[type="checkbox"]').each(function(){d(this).prop("checked",a);var b=d(this),e=a?'a[class!="cur"]':"a.cur";d(this).siblings(".sd-select-district").children(e).each(function(){q(this,b,c)})})});
e(".sd-select-title .sd-select-all").click(function(){var a=d(this).hasClass("cur")?!1:!0;d(this).toggleClass("cur");var b=h.find(".sd-selection-area strong"),c=h.find(".sd-selection-area span");0<c.length&&c.each(function(){e('.sd-select-show[data-value="'+d(this).attr("data-value")+'"]').each(function(){d(this).find('.sd-select-province-all input[type="checkbox"]').prop("checked",!1);d(this).find('.sd-select-province input[type="checkbox"]').prop("checked",!1);d(this).find(".sd-select-city ul li .sd-select-district a.cur").removeClass("cur");
d(this).find('.sd-select-city ul li > input[type="checkbox"]').each(function(){d(this).prop("checked",!1);d(this).siblings(".sd-select-statistics").children(".already").text(0)})});d(this).remove()});if(a)e(".sd-select-area, .sd-select-content").append('<div class="sd-select-cover"></div>'),e().append('<div class="sd-select-color-pop">\u9009\u62e9\u5168\u56fd\u65f6\u4e0b\u8fb9\u7684\u533a\u57df\u9009\u53d6\u7684\u5c06\u81ea\u52a8\u53d6\u6d88\u9009\u62e9\uff0c\u540c\u65f6\u4e0d\u80fd\u9009\u53d6\uff01<div class="pop-arrow"></div></div>'),
setTimeout(function(){e(".sd-select-color-pop").fadeOut("slow",function(){d(this).remove()})},2600);else if(e(".sd-select-cover").remove(),0<b.length)return b.remove(),l(null,5),n(),0;l(this,4);h.find(".sd-selection-area").append('<strong data-value="all">\u5168\u56fd <i title="\u53d6\u6d88"></i></strong>');n()});d(this).on("click",".sd-selection-area strong i",function(){l(null,5);d(this).parent("strong").remove();e(".sd-select-cover").remove();e(".sd-select-title .sd-select-all").removeClass("cur");
n()})}})(jQuery);
